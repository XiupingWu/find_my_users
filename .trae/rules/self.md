# 自我记忆文件

## 已知错误及修复方法

### 1. TypeScript 类型定义不完整
**错误现象**: 组件中使用的属性在接口定义中缺失，导致编译错误
**修复方法**: 
- 检查组件中实际使用的所有属性
- 在接口定义中添加缺失的属性
- 确保类型定义与实际数据结构一致

### 2. 未使用 Shadcn/ui 组件规范
**错误现象**: 直接使用原生HTML元素而不是Shadcn/ui组件
**修复方法**: 
- 使用 `@/components/ui/` 中的组件
- 遵循Shadcn/ui的设计系统和API规范

### 3. 忘记添加函数注释
**错误现象**: 函数缺少JSDoc注释
**修复方法**: 
- 为每个函数添加详细的JSDoc注释
- 包含参数说明、返回值说明和功能描述

### 4. 未正确使用SWR进行数据获取
**错误现象**: 直接使用fetch而不是SWR
**修复方法**: 
- 使用 `useSWR` hook进行数据获取
- 配置适当的缓存和重新验证策略

### 5. 未使用 `cn()` 函数合并类名
**错误现象**: 直接拼接字符串处理CSS类名
**修复方法**: 
- 使用 `@/lib/utils` 中的 `cn()` 函数
- 支持条件类名和类名合并

### 6. 未遵循响应式设计原则
**错误现象**: 组件在不同屏幕尺寸下显示异常
**修复方法**: 
- 使用Tailwind CSS的响应式前缀
- 测试不同屏幕尺寸下的显示效果

### 7. 环境变量使用不当
**错误现象**: 在客户端组件中使用服务端环境变量
**修复方法**: 
- 客户端变量使用 `NEXT_PUBLIC_` 前缀
- 服务端变量只在服务端组件中使用

### 8. 字段映射不完整
**错误现象**: 页面显示原始字段值而不是翻译后的文本
**修复方法**: 
- 检查实际数据文件中使用的字段值
- 在 `field-utils.ts` 中补充 `zhFields` 和 `enFields` 对象中缺失的字段值映射
- 确保 `field-utils.ts` 包含所有实际使用的映射
- 同时更新中英文映射
- 使用 `getFieldDisplayText` 函数进行字段值转换
- 确保组件中调用 `getFieldDisplayText` 时使用正确的字段类型参数

### 14. 字段映射合并维护优化
**需求**: 将分散在多个文件中的字段映射数据统一管理，减少维护成本
**问题分析**:
- 项目中存在三个文件维护相同的字段映射数据：`/data/json/zh/site-fields.json`、`/data/json/en/site-fields.json`、`/src/lib/field-utils.ts`
- 重复维护导致数据不一致和维护成本高
- 硬编码的字段映射难以扩展和维护
**实现方案**:
- 重构 `field-utils.ts`，移除硬编码的 `zhFields` 和 `enFields` 对象
- 使用 `getI18nJsonData` 函数从JSON文件读取字段映射数据
- 添加字段数据缓存机制避免重复读取文件
- 完善JSON文件中的字段映射，添加缺失的字段类型
- 保持向后兼容性和错误处理机制
**修复要点**:
- 数据源统一，减少重复维护
- 缓存机制提升性能
- 完整的错误处理确保系统稳定性
- 保持原有函数接口不变

### 9. 站点详情页结构统一
**需求**: 使站点详情页与文章详情页保持一致的结构和样式
**修复步骤**:
- 参考文章详情页的布局结构
- 统一面包屑导航样式
- 统一标题和描述区域布局
- 统一内容区域的间距和排版
- 确保响应式设计的一致性

### 10. 分类筛选字段统一
**错误现象**: 代码中同时使用 `category` 和 `type` 字段，造成混淆和不一致
**原因分析**: 
- 历史遗留问题导致字段命名不统一
- 实际数据文件中使用的是 `type` 字段
- 组件接口定义中保留了 `category` 字段用于向后兼容
**修复方法**:
- 统一使用 `type` 字段进行分类
- 从所有组件接口定义中移除 `category` 字段
- 更新所有相关的筛选逻辑和显示逻辑
- 确保数据结构与代码逻辑的一致性
**修复要点**:
- 检查所有使用分类字段的组件
- 统一字段命名，避免混淆
- 保持代码的简洁性和一致性
- 移除不必要的向后兼容代码

### 11. 文章数据结构优化
**需求**: 将分离的中英文articles.json文件合并为单一文件，减少维护成本
**实现方案**:
- 创建统一的articles.json文件，包含`title_zh`、`title_en`、`description_zh`、`description_en`字段
- 更新`getI18nArticlesList`函数支持新的数据结构
- 根据locale参数动态选择对应语言的字段
- 保持向后兼容，支持fallback到原有分离文件结构
**修复要点**:
- 数据结构统一，减少文件数量
- 保持多语言功能完整性
- 确保数据获取逻辑的健壮性
- 删除冗余的分离文件

### 12. 站点列表数据结构优化
**需求**: 将分离的中英文sitelists.json文件合并为单一文件，减少维护成本
**实现方案**:
- 创建统一的sitelists.json文件，包含`name_zh`、`name_en`字段
- 更新`getI18nSitesList`函数支持新的合并格式
- 根据locale参数动态选择对应语言的名称字段
- 保持向后兼容，支持fallback到原有分离文件结构
**修复要点**:
- 数据结构统一，减少文件数量
- 保持多语言功能完整性
- 确保站点名称的正确显示
- 删除冗余的分离文件
- 支持中英文名称不同的情况（如"音乐播放器"/"Music Player"）

### 13. Site 文件夹数据结构优化
**需求**: 将 `/data/Site` 文件夹中的中英文 JSON 文件合并为单一文件，减少维护成本
**实现方案**:
- 创建统一的 JSON 文件，包含 `name_zh`、`name_en`、`description_zh`、`description_en`、`submitRequirements_zh`、`submitRequirements_en`、`rating_zh`、`rating_en` 字段
- 更新 `getI18nSiteData` 函数支持新的合并格式
- 根据 locale 参数动态选择对应语言的字段
- 保持向后兼容，支持 fallback 到原有分离文件结构
**修复要点**:
- 数据结构统一，减少文件数量
- 保持多语言功能完整性
- 确保站点详情的正确显示
- 删除冗余的分离文件和目录结构
- 支持中英文内容不同的情况
- 将函数改为异步函数以正确处理 Promise